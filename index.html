<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recruitment Management System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Login Screen */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: white;
            padding: 50px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 450px;
            width: 100%;
            animation: slideUp 0.5s;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-box h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-align: center;
        }

        .login-box p {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .btn-small {
            width: auto;
            padding: 10px 20px;
            font-size: 14px;
            display: inline-block;
        }

        .demo-accounts {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 10px;
            font-size: 14px;
        }

        .demo-accounts h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .demo-accounts p {
            margin: 5px 0;
            text-align: left;
        }

        /* Dashboard Layout */
        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .dashboard-header {
            background: white;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dashboard-header h1 {
            color: #667eea;
            font-size: 2.5em;
        }

        .user-info {
            text-align: right;
        }

        .user-info h3 {
            color: #333;
            margin-bottom: 5px;
        }

        .role-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .role-admin { background: #ff6b6b; color: white; }
        .role-recruiter { background: #4dabf7; color: white; }
        .role-candidate { background: #51cf66; color: white; }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .menu-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
            border-left: 5px solid #667eea;
        }

        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .menu-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.5em;
        }

        .menu-card p {
            color: #666;
            line-height: 1.6;
        }

        .content-panel {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            display: none;
        }

        .content-panel.active {
            display: block;
            animation: slideUp 0.5s;
        }

        .content-panel h2 {
            color: #667eea;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
        }

        .back-btn {
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        table tr:hover {
            background: #f8f9ff;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 15px;
            color: white;
            text-align: center;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .stat-card h3 {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .stat-card p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .application-card {
            background: #f8f9ff;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
        }

        .application-card h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .badge {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            margin: 3px;
        }

        .badge-applied { background: #e3f2fd; color: #1976d2; }
        .badge-screening { background: #fff3e0; color: #f57c00; }
        .badge-interview { background: #f3e5f5; color: #7b1fa2; }
        .badge-hired { background: #e8f5e9; color: #388e3c; }
        .badge-rejected { background: #ffebee; color: #c62828; }

        .score-display {
            font-size: 2.5em;
            font-weight: bold;
            color: #764ba2;
            text-align: center;
            margin: 20px 0;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 12px;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 100%;
            transition: width 0.5s;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .alert-info {
            background: #e3f2fd;
            border-left: 5px solid #1976d2;
            color: #0d47a1;
        }

        .alert-warning {
            background: #fff3e0;
            border-left: 5px solid #f57c00;
            color: #e65100;
        }

        .alert-success {
            background: #e8f5e9;
            border-left: 5px solid #388e3c;
            color: #1b5e20;
        }

        .chart-container {
            margin: 30px 0;
            padding: 25px;
            background: #f8f9ff;
            border-radius: 15px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .hidden { display: none !important; }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-content h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <h1>üéØ RMS</h1>
            <p>Recruitment Management System</p>
            
            <form id="loginForm" onsubmit="login(event)">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" value="demo123" required>
                </div>
                <button type="submit" class="btn">Login</button>
            </form>

            <div class="demo-accounts">
                <h4>üìù Demo Accounts (Click to auto-fill):</h4>
                <p><strong onclick="fillLogin('admin@company.com')" style="cursor:pointer;color:#667eea">üëë Admin:</strong> admin@company.com</p>
                <p><strong onclick="fillLogin('recruiter1@company.com')" style="cursor:pointer;color:#667eea">üëî Recruiter:</strong> recruiter1@company.com</p>
                <p><strong onclick="fillLogin('ayaan@gmail.com')" style="cursor:pointer;color:#667eea">üë§ Candidate:</strong> ayaan@gmail.com</p>
                <p style="margin-top:10px;"><em>Password: demo123 (for all)</em></p>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="dashboard container">
        <div class="dashboard-header">
            <div>
                <h1>Admin Dashboard</h1>
                <p>Complete System Control</p>
            </div>
            <div class="user-info">
                <span class="role-badge role-admin">ADMIN</span>
                <h3 id="adminName"></h3>
                <button class="btn btn-small" onclick="logout()">Logout</button>
            </div>
        </div>

        <div id="adminMenu" class="menu-grid">
            <div class="menu-card" onclick="showAdminPanel('analytics')">
                <h3>üìä System Analytics</h3>
                <p>View all hiring metrics, performance data, and system-wide statistics</p>
            </div>
            <div class="menu-card" onclick="showAdminPanel('reports')">
                <h3>üìà Advanced Reports</h3>
                <p>Bias detection, skill gaps, hiring bottlenecks, and predictive analytics</p>
            </div>
            <div class="menu-card" onclick="showAdminPanel('users')">
                <h3>üë• Manage Users</h3>
                <p>View, edit, and manage all system users and role assignments</p>
            </div>
            <div class="menu-card" onclick="showAdminPanel('audit')">
                <h3>üîí Audit Logs</h3>
                <p>Complete audit trail of all system activities and changes</p>
            </div>
            <div class="menu-card" onclick="showAdminPanel('alldata')">
                <h3>üóÇÔ∏è All Data</h3>
                <p>Access all jobs, applications, and candidates across the system</p>
            </div>
            <div class="menu-card" onclick="showAdminPanel('system')">
                <h3>‚öôÔ∏è System Config</h3>
                <p>Archive old data, anonymize candidates, system maintenance</p>
            </div>
        </div>

        <div id="adminContent"></div>
    </div>

    <!-- Recruiter Dashboard -->
    <div id="recruiterDashboard" class="dashboard container">
        <div class="dashboard-header">
            <div>
                <h1>Recruiter Dashboard</h1>
                <p>Manage Jobs & Applications</p>
            </div>
            <div class="user-info">
                <span class="role-badge role-recruiter">RECRUITER</span>
                <h3 id="recruiterName"></h3>
                <button class="btn btn-small" onclick="logout()">Logout</button>
            </div>
        </div>

        <div id="recruiterMenu" class="menu-grid">
            <div class="menu-card" onclick="showRecruiterPanel('viewapps')">
                <h3>üìã View Applications</h3>
                <p>Review all applications with filtering and sorting options</p>
            </div>
            <div class="menu-card" onclick="showRecruiterPanel('candidates')">
                <h3>üéØ Review Candidates</h3>
                <p>View candidate rankings with weighted match scores</p>
            </div>
            <div class="menu-card" onclick="showRecruiterPanel('schedule')">
                <h3>üìÖ Schedule Interviews</h3>
                <p>Schedule interviews with automatic conflict detection</p>
            </div>
            <div class="menu-card" onclick="showRecruiterPanel('updatestatus')">
                <h3>üîÑ Update Status</h3>
                <p>Move applications through the hiring workflow</p>
            </div>
            <div class="menu-card" onclick="showRecruiterPanel('hire')">
                <h3>‚úÖ Hire Candidates</h3>
                <p>Execute concurrency-safe hiring with vacancy control</p>
            </div>
            <div class="menu-card" onclick="showRecruiterPanel('feedback')">
                <h3>üí¨ Interview Feedback</h3>
                <p>Submit interview scores and recommendations</p>
            </div>
        </div>

        <div id="recruiterContent"></div>
    </div>

    <!-- Candidate Dashboard -->
    <div id="candidateDashboard" class="dashboard container">
        <div class="dashboard-header">
            <div>
                <h1>Candidate Dashboard</h1>
                <p>Your Job Applications</p>
            </div>
            <div class="user-info">
                <span class="role-badge role-candidate">CANDIDATE</span>
                <h3 id="candidateName"></h3>
                <button class="btn btn-small" onclick="logout()">Logout</button>
            </div>
        </div>

        <div id="candidateMenu" class="menu-grid">
            <div class="menu-card" onclick="showCandidatePanel('browse')">
                <h3>üîç Browse Jobs</h3>
                <p>View all active job postings and apply</p>
            </div>
            <div class="menu-card" onclick="showCandidatePanel('myapps')">
                <h3>üìù My Applications</h3>
                <p>Track status of all your applications</p>
            </div>
            <div class="menu-card" onclick="showCandidatePanel('interviews')">
                <h3>üìÖ My Interviews</h3>
                <p>View scheduled interviews and confirm attendance</p>
            </div>
            <div class="menu-card" onclick="showCandidatePanel('profile')">
                <h3>üë§ Manage Profile</h3>
                <p>Update skills, experience, and documents</p>
            </div>
        </div>

        <div id="candidateContent"></div>
    </div>

    <!-- Modal for forms -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        let db;
        let currentUser = null;
        let charts = {};

        // Initialize database
        async function initDB() {
            try {
                const SQL = await initSqlJs({
                    locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${file}`
                });

                const response = await fetch('recruitment.db');
                if (!response.ok) throw new Error('Database not found');
                
                const buffer = await response.arrayBuffer();
                db = new SQL.Database(new Uint8Array(buffer));
                
                console.log('Database loaded successfully');
            } catch (error) {
                console.error('Database error:', error);
                alert('Please upload recruitment.db file to your GitHub repository');
            }
        }

        function query(sql, params = []) {
            try {
                const result = db.exec(sql, params);
                return result[0] || { columns: [], values: [] };
            } catch (error) {
                console.error('Query error:', error, sql);
                return { columns: [], values: [] };
            }
        }

        function fillLogin(email) {
            document.getElementById('loginEmail').value = email;
            document.getElementById('loginPassword').value = 'demo123';
        }

        function login(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            
            const result = query(`
                SELECT u.UserID, u.Username, u.Email, u.RoleID, r.RoleName,
                       c.CandidateID, c.FullName as CandidateName,
                       rec.RecruiterID
                FROM Users u
                JOIN Roles r ON u.RoleID = r.RoleID
                LEFT JOIN Candidates c ON u.UserID = c.UserID
                LEFT JOIN Recruiters rec ON u.UserID = rec.UserID
                WHERE u.Email = '${email}' AND u.IsActive = 1
            `);

            if (result.values.length === 0) {
                alert('Invalid credentials or account inactive');
                return;
            }

            const userData = result.values[0];
            currentUser = {
                userID: userData[0],
                username: userData[1],
                email: userData[2],
                roleID: userData[3],
                roleName: userData[4],
                candidateID: userData[5],
                candidateName: userData[6],
                recruiterID: userData[7]
            };

            document.getElementById('loginScreen').style.display = 'none';
            
            if (currentUser.roleID === 1) {
                showAdminDashboard();
            } else if (currentUser.roleID === 2) {
                showRecruiterDashboard();
            } else if (currentUser.roleID === 3) {
                showCandidateDashboard();
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('adminDashboard').classList.remove('active');
            document.getElementById('recruiterDashboard').classList.remove('active');
            document.getElementById('candidateDashboard').classList.remove('active');
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('loginForm').reset();
        }

        // Admin Functions
        function showAdminDashboard() {
            document.getElementById('adminName').textContent = currentUser.username;
            document.getElementById('adminDashboard').classList.add('active');
        }

        function showAdminPanel(panel) {
            const content = document.getElementById('adminContent');
            content.innerHTML = '<div class="content-panel active"><button class="btn btn-secondary back-btn" onclick="hideAdminPanel()">‚Üê Back to Menu</button><div id="panelData"></div></div>';
            const panelData = document.getElementById('panelData');

            if (panel === 'analytics') {
                showSystemAnalytics(panelData);
            } else if (panel === 'reports') {
                showAdvancedReports(panelData);
            } else if (panel === 'users') {
                showAllUsers(panelData);
            } else if (panel === 'audit') {
                showAuditLogs(panelData);
            } else if (panel === 'alldata') {
                showAllData(panelData);
            } else if (panel === 'system') {
                showSystemConfig(panelData);
            }
        }

        function hideAdminPanel() {
            document.getElementById('adminContent').innerHTML = '';
        }

        function showSystemAnalytics(container) {
            const candidates = query('SELECT COUNT(*) FROM Candidates').values[0][0];
            const jobs = query('SELECT COUNT(*) FROM JobPostings WHERE IsActive = 1').values[0][0];
            const applications = query('SELECT COUNT(*) FROM Applications').values[0][0];
            const hired = query('SELECT COUNT(*) FROM Applications WHERE StatusID = 4').values[0][0];

            container.innerHTML = `
                <h2>üìä System Analytics</h2>
                <div class="stats-grid">
                    <div class="stat-card"><h3>${candidates}</h3><p>Total Candidates</p></div>
                    <div class="stat-card"><h3>${jobs}</h3><p>Active Jobs</p></div>
                    <div class="stat-card"><h3>${applications}</h3><p>Total Applications</p></div>
                    <div class="stat-card"><h3>${hired}</h3><p>Hired</p></div>
                </div>
                <div class="chart-container">
                    <h3>Application Funnel</h3>
                    <canvas id="adminFunnelChart"></canvas>
                </div>
            `;

            const funnel = query('SELECT * FROM vw_ApplicationFunnel');
            const ctx = document.getElementById('adminFunnelChart');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: funnel.values.map(r => r[0]),
                    datasets: [{
                        label: 'Applications',
                        data: funnel.values.map(r => r[1]),
                        backgroundColor: 'rgba(102, 126, 234, 0.8)'
                    }]
                },
                options: { responsive: true, plugins: { legend: { display: false } } }
            });
        }

        function showAdvancedReports(container) {
            const bias = query('SELECT * FROM vw_Bias_Location');
            const biasExp = query('SELECT * FROM vw_Bias_Experience');
            const skills = query('SELECT * FROM vw_SkillGapAnalysis WHERE JobsRequiringSkill > 0 ORDER BY SkillGap DESC LIMIT 10');
            const bottlenecks = query('SELECT * FROM vw_HiringBottlenecks');
            const silent = query('SELECT * FROM vw_SilentRejections');
            const rejections = query('SELECT * FROM vw_RejectionAnalysis');
            const avgTime = query('SELECT * FROM vw_AverageTimeToHire');
            const recruiterPerf = query('SELECT * FROM vw_RecruiterPerformance');
            const interviewScore = query('SELECT * FROM vw_InterviewScoreVsDecision');
            const interviewerConsist = query('SELECT * FROM vw_InterviewerConsistency');
            const engagement = query('SELECT * FROM vw_CandidateEngagement');
            const vacancy = query('SELECT * FROM vw_VacancyUtilization');
            
            let html = '<h2>üìà Advanced Reports & Analytics</h2>';
            html += '<div class="alert alert-warning">‚ö†Ô∏è Bias detection flags statistical anomalies for review - does not accuse bias</div>';
            
            // Stats Grid
            html += '<div class="stats-grid">';
            if (avgTime.values.length > 0 && avgTime.values[0][0]) {
                html += `<div class="stat-card"><h3>${Math.round(avgTime.values[0][0])}</h3><p>Avg Days to Hire</p></div>`;
            }
            html += '</div>';
            
            // Bias Detection by Location
            html += '<h3 style="margin-top:30px">üåç Bias Detection: Location</h3>';
            html += '<table><tr><th>Location</th><th>Applicants</th><th>Hired</th><th>Rate %</th></tr>';
            bias.values.forEach(row => {
                const rate = row[3] || 0;
                const rateColor = rate < 10 ? '#c62828' : rate > 15 ? '#388e3c' : '#f57c00';
                html += `<tr><td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td><td style="color:${rateColor};font-weight:bold">${rate}%</td></tr>`;
            });
            html += '</table>';
            
            // Bias Detection by Experience
            html += '<h3 style="margin-top:30px">üìä Bias Detection: Experience Level</h3>';
            html += '<table><tr><th>Experience Group</th><th>Applicants</th><th>Hired</th><th>Rate %</th></tr>';
            biasExp.values.forEach(row => {
                html += `<tr><td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}%</td></tr>`;
            });
            html += '</table>';
            
            // Skill Gap Analysis
            html += '<h3 style="margin-top:30px">üéØ Skill Gap Analysis</h3>';
            html += '<table><tr><th>Skill</th><th>Jobs Requiring</th><th>Candidates Having</th><th>Gap</th></tr>';
            skills.values.forEach(row => {
                const gapColor = row[3] > 5 ? '#c62828' : row[3] > 2 ? '#f57c00' : '#388e3c';
                html += `<tr><td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td><td style="color:${gapColor};font-weight:bold">${row[3]}</td></tr>`;
            });
            html += '</table>';
            
            // Hiring Bottlenecks
            html += '<h3 style="margin-top:30px">‚è±Ô∏è Hiring Bottlenecks</h3>';
            html += '<table><tr><th>Stage</th><th>Applications</th><th>Avg Days in Stage</th></tr>';
            bottlenecks.values.forEach(row => {
                html += `<tr><td>${row[0]}</td><td>${row[1]}</td><td>${row[2] ? Math.round(row[2]) : 'N/A'}</td></tr>`;
            });
            html += '</table>';
            
            // Silent Rejections
            if (silent.values.length > 0) {
                html += '<h3 style="margin-top:30px">‚ö†Ô∏è Silent Rejections (>30 days inactive)</h3>';
                html += '<table><tr><th>Candidate</th><th>Job</th><th>Status</th><th>Days Inactive</th></tr>';
                silent.values.forEach(row => {
                    html += `<tr><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td><td style="color:#c62828;font-weight:bold">${row[4]}</td></tr>`;
                });
                html += '</table>';
            }
            
            // Rejection Analysis
            if (rejections.values.length > 0) {
                html += '<h3 style="margin-top:30px">üìâ Rejection Analysis</h3>';
                html += '<table><tr><th>Reason</th><th>Count</th></tr>';
                rejections.values.forEach(row => {
                    html += `<tr><td>${row[0]}</td><td>${row[1]}</td></tr>`;
                });
                html += '</table>';
            }
            
            // Recruiter Performance
            if (recruiterPerf.values.length > 0) {
                html += '<h3 style="margin-top:30px">üëî Recruiter Performance</h3>';
                html += '<table><tr><th>Recruiter ID</th><th>Interviews Conducted</th><th>Successful Hires</th></tr>';
                recruiterPerf.values.forEach(row => {
                    html += `<tr><td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td></tr>`;
                });
                html += '</table>';
            }
            
            // Interview Score vs Decision
            if (interviewScore.values.length > 0) {
                html += '<h3 style="margin-top:30px">üéì Interview Score vs Final Decision</h3>';
                html += '<table><tr><th>Candidate</th><th>Avg Interview Score</th><th>Final Status</th><th>Alignment</th></tr>';
                interviewScore.values.forEach(row => {
                    const score = row[2];
                    const status = row[3];
                    let alignment = 'Review Needed';
                    if ((status === 'Hired' && score >= 7) || (status === 'Rejected' && score < 5)) {
                        alignment = 'Aligned';
                    }
                    const alignColor = alignment === 'Aligned' ? '#388e3c' : '#f57c00';
                    html += `<tr><td>${row[1]}</td><td>${score.toFixed(1)}</td><td>${getStatusBadge(status)}</td><td style="color:${alignColor};font-weight:bold">${alignment}</td></tr>`;
                });
                html += '</table>';
            }
            
            // Interviewer Consistency
            if (interviewerConsist.values.length > 0) {
                html += '<h3 style="margin-top:30px">üìã Interviewer Consistency</h3>';
                html += '<table><tr><th>Interviewer ID</th><th>Interviews</th><th>Avg Score Given</th><th>Assessment</th></tr>';
                interviewerConsist.values.forEach(row => {
                    const avgScore = row[2];
                    let assessment = 'Balanced';
                    let assessColor = '#388e3c';
                    if (avgScore > 8.5) {
                        assessment = 'Too Lenient';
                        assessColor = '#f57c00';
                    } else if (avgScore < 5) {
                        assessment = 'Too Harsh';
                        assessColor = '#c62828';
                    }
                    html += `<tr><td>${row[0]}</td><td>${row[1]}</td><td>${avgScore.toFixed(1)}</td><td style="color:${assessColor};font-weight:bold">${assessment}</td></tr>`;
                });
                html += '</table>';
            }
            
            // Candidate Engagement
            if (engagement.values.length > 0) {
                html += '<h3 style="margin-top:30px">üíº Candidate Engagement</h3>';
                html += '<table><tr><th>Candidate</th><th>Interviews Scheduled</th><th>Confirmed</th><th>Engagement Rate</th></tr>';
                engagement.values.forEach(row => {
                    const rate = row[4] || 0;
                    const rateColor = rate > 75 ? '#388e3c' : rate > 50 ? '#f57c00' : '#c62828';
                    html += `<tr><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td><td style="color:${rateColor};font-weight:bold">${rate.toFixed(0)}%</td></tr>`;
                });
                html += '</table>';
            }
            
            // Vacancy Utilization
            if (vacancy.values.length > 0) {
                html += '<h3 style="margin-top:30px">üìä Vacancy Utilization</h3>';
                html += '<table><tr><th>Job</th><th>Remaining Vacancies</th><th>Total Applications</th><th>Filled Positions</th></tr>';
                vacancy.values.forEach(row => {
                    html += `<tr><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td><td>${row[4]}</td></tr>`;
                });
                html += '</table>';
            }
            
            container.innerHTML = html;
        }

        function showAllUsers(container) {
            const users = query(`
                SELECT u.UserID, u.Username, u.Email, r.RoleName, u.IsActive
                FROM Users u
                JOIN Roles r ON u.RoleID = r.RoleID
                ORDER BY r.RoleName, u.Username
            `);

            let html = '<h2>üë• Manage Users</h2><table><tr><th>User ID</th><th>Username</th><th>Email</th><th>Role</th><th>Status</th></tr>';
            users.values.forEach(row => {
                const status = row[4] ? '<span class="badge badge-hired">Active</span>' : '<span class="badge badge-rejected">Inactive</span>';
                html += `<tr><td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td><td>${status}</td></tr>`;
            });
            html += '</table>';
            container.innerHTML = html;
        }

        function showAuditLogs(container) {
            const logs = query('SELECT * FROM AuditLog ORDER BY ChangedAt DESC LIMIT 50');
            let html = '<h2>üîí Audit Logs</h2><table><tr><th>Table</th><th>Record ID</th><th>Operation</th><th>Old Value</th><th>New Value</th><th>Changed By</th><th>Date</th></tr>';
            
            logs.values.forEach(row => {
                html += `<tr><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td><td>${row[4]}</td><td>${row[5]}</td><td>${row[6]}</td><td>${row[7]}</td></tr>`;
            });
            
            html += '</table>';
            container.innerHTML = html;
        }

        function showAllData(container) {
            const jobs = query('SELECT JobID, JobTitle, Location, Vacancies, IsActive FROM JobPostings');
            const apps = query('SELECT COUNT(*) FROM Applications').values[0][0];
            const candidates = query('SELECT COUNT(*) FROM Candidates').values[0][0];

            let html = `<h2>üóÇÔ∏è All Data</h2>`;
            html += `<div class="alert alert-info">Total: ${candidates} candidates, ${jobs.values.length} jobs, ${apps} applications</div>`;
            html += '<h3>All Job Postings</h3><table><tr><th>ID</th><th>Title</th>
